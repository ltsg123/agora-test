import{g as St,c as Tt}from"./_commonjsHelpers.725317a4.js";function bt(t,s){for(var i=0;i<s.length;i++){const r=s[i];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in t)){const c=Object.getOwnPropertyDescriptor(r,a);c&&Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}let ve=!0,Se=!0;function N(t,s,i){const r=t.match(s);return r&&r.length>=i&&parseInt(r[i],10)}function O(t,s,i){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,a=r.addEventListener;r.addEventListener=function(h,p){if(h!==s)return a.apply(this,arguments);const m=l=>{const u=i(l);u&&(p.handleEvent?p.handleEvent(u):p(u))};return this._eventMap=this._eventMap||{},this._eventMap[s]||(this._eventMap[s]=new Map),this._eventMap[s].set(p,m),a.apply(this,[h,m])};const c=r.removeEventListener;r.removeEventListener=function(h,p){if(h!==s||!this._eventMap||!this._eventMap[s])return c.apply(this,arguments);if(!this._eventMap[s].has(p))return c.apply(this,arguments);const m=this._eventMap[s].get(p);return this._eventMap[s].delete(p),this._eventMap[s].size===0&&delete this._eventMap[s],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[h,m])},Object.defineProperty(r,"on"+s,{get(){return this["_on"+s]},set(h){this["_on"+s]&&(this.removeEventListener(s,this["_on"+s]),delete this["_on"+s]),h&&this.addEventListener(s,this["_on"+s]=h)},enumerable:!0,configurable:!0})}function Rt(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(ve=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Pt(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Se=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Te(){if(typeof window=="object"){if(ve)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function w(t,s){Se&&console.warn(t+" is deprecated, please use "+s+" instead.")}function xt(t){const s={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return s.browser="Not a browser.",s;const{navigator:i}=t;if(i.mozGetUserMedia)s.browser="firefox",s.version=N(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)s.browser="chrome",s.version=N(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))s.browser="safari",s.version=N(i.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return s.browser="Not a supported browser.",s;return s}function ue(t){return Object.prototype.toString.call(t)==="[object Object]"}function be(t){return ue(t)?Object.keys(t).reduce(function(s,i){const r=ue(t[i]),a=r?be(t[i]):t[i],c=r&&!Object.keys(a).length;return a===void 0||c?s:Object.assign(s,{[i]:a})},{}):t}function K(t,s,i){!s||i.has(s.id)||(i.set(s.id,s),Object.keys(s).forEach(r=>{r.endsWith("Id")?K(t,t.get(s[r]),i):r.endsWith("Ids")&&s[r].forEach(a=>{K(t,t.get(a),i)})}))}function he(t,s,i){const r=i?"outbound-rtp":"inbound-rtp",a=new Map;if(s===null)return a;const c=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===s.id&&c.push(h)}),c.forEach(h=>{t.forEach(p=>{p.type===r&&p.trackId===h.id&&K(t,p,a)})}),a}const de=Te;function Re(t,s){const i=t&&t.navigator;if(!i.mediaDevices)return;const r=function(p){if(typeof p!="object"||p.mandatory||p.optional)return p;const m={};return Object.keys(p).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof p[l]=="object"?p[l]:{ideal:p[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const g=function(y,v){return y?y+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(u.ideal!==void 0){m.optional=m.optional||[];let y={};typeof u.ideal=="number"?(y[g("min",l)]=u.ideal,m.optional.push(y),y={},y[g("max",l)]=u.ideal,m.optional.push(y)):(y[g("",l)]=u.ideal,m.optional.push(y))}u.exact!==void 0&&typeof u.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[g("",l)]=u.exact):["min","max"].forEach(y=>{u[y]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[g(y,l)]=u[y])})}),p.advanced&&(m.optional=(m.optional||[]).concat(p.advanced)),m},a=function(p,m){if(s.version>=61)return m(p);if(p=JSON.parse(JSON.stringify(p)),p&&typeof p.audio=="object"){const l=function(u,g,y){g in u&&!(y in u)&&(u[y]=u[g],delete u[g])};p=JSON.parse(JSON.stringify(p)),l(p.audio,"autoGainControl","googAutoGainControl"),l(p.audio,"noiseSuppression","googNoiseSuppression"),p.audio=r(p.audio)}if(p&&typeof p.video=="object"){let l=p.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=s.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete p.video.facingMode;let g;if(l.exact==="environment"||l.ideal==="environment"?g=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(g=["front"]),g)return i.mediaDevices.enumerateDevices().then(y=>{y=y.filter(b=>b.kind==="videoinput");let v=y.find(b=>g.some(T=>b.label.toLowerCase().includes(T)));return!v&&y.length&&g.includes("back")&&(v=y[y.length-1]),v&&(p.video.deviceId=l.exact?{exact:v.deviceId}:{ideal:v.deviceId}),p.video=r(p.video),de("chrome: "+JSON.stringify(p)),m(p)})}p.video=r(p.video)}return de("chrome: "+JSON.stringify(p)),m(p)},c=function(p){return s.version>=64?p:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[p.name]||p.name,message:p.message,constraint:p.constraint||p.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},h=function(p,m,l){a(p,u=>{i.webkitGetUserMedia(u,m,g=>{l&&l(c(g))})})};if(i.getUserMedia=h.bind(i),i.mediaDevices.getUserMedia){const p=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return a(m,l=>p(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(c(u))))}}}function kt(t,s){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&t.navigator.mediaDevices){if(typeof s!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=function(r){return s(r).then(a=>{const c=r.video&&r.video.width,h=r.video&&r.video.height,p=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:p||3}},c&&(r.video.mandatory.maxWidth=c),h&&(r.video.mandatory.maxHeight=h),t.navigator.mediaDevices.getUserMedia(r)})}}}function Pe(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function xe(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let c;t.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(p=>p.track&&p.track.id===a.track.id):c={track:a.track};const h=new Event("track");h.track=a.track,h.receiver=c,h.transceiver={receiver:c},h.streams=[r.stream],this.dispatchEvent(h)}),r.stream.getTracks().forEach(a=>{let c;t.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(p=>p.track&&p.track.id===a.id):c={track:a};const h=new Event("track");h.track=a,h.receiver=c,h.transceiver={receiver:c},h.streams=[r.stream],this.dispatchEvent(h)})},this.addEventListener("addstream",this._ontrackpoly)),s.apply(this,arguments)}}else O(t,"track",s=>(s.transceiver||Object.defineProperty(s,"transceiver",{value:{receiver:s.receiver}}),s))}function ke(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const s=function(a,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=a.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:a}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(p,m){let l=a.apply(this,arguments);return l||(l=s(this,p),this._senders.push(l)),l};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(p){c.apply(this,arguments);const m=this._senders.indexOf(p);m!==-1&&this._senders.splice(m,1)}}const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(h=>{this._senders.push(s(this,h))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(h=>{const p=this._senders.find(m=>m.track===h);p&&this._senders.splice(this._senders.indexOf(p),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=s.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ee(t){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,a,c]=arguments;if(arguments.length>0&&typeof r=="function")return s.apply(this,arguments);if(s.length===0&&(arguments.length===0||typeof r!="function"))return s.apply(this,[]);const h=function(m){const l={};return m.result().forEach(g=>{const y={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(v=>{y[v]=g.stat(v)}),l[y.id]=y}),l},p=function(m){return new Map(Object.keys(m).map(l=>[l,m[l]]))};if(arguments.length>=2){const m=function(l){a(p(h(l)))};return s.apply(this,[m,r])}return new Promise((m,l)=>{s.apply(this,[function(u){m(p(h(u)))},l])}).then(a,c)}}function Oe(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(h=>h._pc=this),c});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=r.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(h=>he(h,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=i.apply(this,[]);return a.forEach(c=>c._pc=this),a}),O(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>he(c,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let a,c,h;return this.getSenders().forEach(p=>{p.track===r&&(a?h=!0:a=p)}),this.getReceivers().forEach(p=>(p.track===r&&(c?h=!0:c=p),p.track===r)),h||a&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}function Me(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(h=>this._shimmedLocalStreams[h][0])};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,p){if(!p)return s.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=s.apply(this,arguments);return this._shimmedLocalStreams[p.id]?this._shimmedLocalStreams[p.id].indexOf(m)===-1&&this._shimmedLocalStreams[p.id].push(m):this._shimmedLocalStreams[p.id]=[p,m],m};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(h){this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(l=>{if(this.getSenders().find(g=>g.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const p=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(l=>p.indexOf(l)===-1);this._shimmedLocalStreams[h.id]=[h].concat(m)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],r.apply(this,arguments)};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(p=>{const m=this._shimmedLocalStreams[p].indexOf(h);m!==-1&&this._shimmedLocalStreams[p].splice(m,1),this._shimmedLocalStreams[p].length===1&&delete this._shimmedLocalStreams[p]}),a.apply(this,arguments)}}function Ie(t,s){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&s.version>=65)return Me(t);const i=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=i.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(g=>this._reverseStreams[g.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(g=>{if(this.getSenders().find(v=>v.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const g=new t.MediaStream(u.getTracks());this._streams[u.id]=g,this._reverseStreams[g.id]=u,u=g}r.apply(this,[u])};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(T=>T===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[g.id];if(b)b.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new t.MediaStream([u]);this._streams[g.id]=T,this._reverseStreams[T.id]=g,this.addStream(T)}return this.getSenders().find(T=>T.track===u)};function c(l,u){let g=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(y=>{const v=l._reverseStreams[y],b=l._streams[v.id];g=g.replace(new RegExp(b.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:g})}function h(l,u){let g=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(y=>{const v=l._reverseStreams[y],b=l._streams[v.id];g=g.replace(new RegExp(v.id,"g"),b.id)}),new RTCSessionDescription({type:u.type,sdp:g})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],g={[l](){const y=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[b=>{const T=c(this,b);y[0].apply(null,[T])},b=>{y[1]&&y[1].apply(null,b)},arguments[2]]):u.apply(this,arguments).then(b=>c(this,b))}};t.RTCPeerConnection.prototype[l]=g[l]});const p=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?p.apply(this,arguments):(arguments[0]=h(this,arguments[0]),p.apply(this,arguments))};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=m.get.apply(this);return l.type===""?l:c(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let y;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(T=>u.track===T)&&(y=this._streams[v])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function q(t,s){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=t.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=a[i]})}function _e(t,s){O(t,"negotiationneeded",i=>{const r=i.target;if(!((s.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return i})}const le=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:_e,shimAddTrackRemoveTrack:Ie,shimAddTrackRemoveTrackWithNative:Me,shimGetDisplayMedia:kt,shimGetSendersWithDtmf:ke,shimGetStats:Ee,shimGetUserMedia:Re,shimMediaStream:Pe,shimOnTrack:xe,shimPeerConnection:q,shimSenderReceiverGetStats:Oe},Symbol.toStringTag,{value:"Module"}));function Ae(t,s){const i=t&&t.navigator,r=t&&t.MediaStreamTrack;if(i.getUserMedia=function(a,c,h){w("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(a).then(c,h)},!(s.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const a=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),a(h.audio,"autoGainControl","mozAutoGainControl"),a(h.audio,"noiseSuppression","mozNoiseSuppression")),c(h)},r&&r.prototype.getSettings){const h=r.prototype.getSettings;r.prototype.getSettings=function(){const p=h.apply(this,arguments);return a(p,"mozAutoGainControl","autoGainControl"),a(p,"mozNoiseSuppression","noiseSuppression"),p}}if(r&&r.prototype.applyConstraints){const h=r.prototype.applyConstraints;r.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),a(p,"autoGainControl","mozAutoGainControl"),a(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function Et(t,s){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return r.video===!0?r.video={mediaSource:s}:r.video.mediaSource=s,t.navigator.mediaDevices.getUserMedia(r)})}function De(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function W(t,s){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const c=t.RTCPeerConnection.prototype[a],h={[a](){return arguments[0]=new(a==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};t.RTCPeerConnection.prototype[a]=h[a]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,h,p]=arguments;return r.apply(this,[c||null]).then(m=>{if(s.version<53&&!h)try{m.forEach(l=>{l.type=i[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;m.forEach((u,g)=>{m.set(g,Object.assign({},u,{type:i[u.type]||u.type}))})}return m}).then(h,p)}}function Le(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=i.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function je(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=s.apply(this,[]);return r.forEach(a=>a._pc=this),r}),O(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Fe(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(i){w("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Ue(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Ne(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const s=t.RTCPeerConnection.prototype.addTransceiver;s&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(h=>{if("rid"in h&&!/^[a-z0-9]{0,16}$/i.test(h.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in h&&!(parseFloat(h.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in h&&!(parseFloat(h.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=s.apply(this,arguments);if(a){const{sender:h}=c,p=h.getParameters();(!("encodings"in p)||p.encodings.length===1&&Object.keys(p.encodings[0]).length===0)&&(p.encodings=r,h.sendEncodings=r,this.setParametersPromises.push(h.setParameters(p).then(()=>{delete h.sendEncodings}).catch(()=>{delete h.sendEncodings})))}return c})}function ze(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const s=t.RTCRtpSender.prototype.getParameters;s&&(t.RTCRtpSender.prototype.getParameters=function(){const r=s.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Ve(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const s=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}function Ge(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const s=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}const me=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Ne,shimCreateAnswer:Ge,shimCreateOffer:Ve,shimGetDisplayMedia:Et,shimGetParameters:ze,shimGetUserMedia:Ae,shimOnTrack:De,shimPeerConnection:W,shimRTCDataChannel:Ue,shimReceiverGetStats:je,shimRemoveStream:Fe,shimSenderGetStats:Le},Symbol.toStringTag,{value:"Module"}));function $e(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(a=>s.call(this,a,r)),r.getVideoTracks().forEach(a=>s.call(this,a,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...a){return a&&a.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),s.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(r===-1)return;this._localStreams.splice(r,1);const a=i.getTracks();this.getSenders().forEach(c=>{a.includes(c.track)&&this.removeTrack(c)})})}}function Je(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const c=new Event("addstream");c.stream=a,this.dispatchEvent(c)})})}});const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,r.dispatchEvent(h)})}),s.apply(r,arguments)}}}function Be(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,i=s.createOffer,r=s.createAnswer,a=s.setLocalDescription,c=s.setRemoteDescription,h=s.addIceCandidate;s.createOffer=function(l,u){const g=arguments.length>=2?arguments[2]:arguments[0],y=i.apply(this,[g]);return u?(y.then(l,u),Promise.resolve()):y},s.createAnswer=function(l,u){const g=arguments.length>=2?arguments[2]:arguments[0],y=r.apply(this,[g]);return u?(y.then(l,u),Promise.resolve()):y};let p=function(m,l,u){const g=a.apply(this,[m]);return u?(g.then(l,u),Promise.resolve()):g};s.setLocalDescription=p,p=function(m,l,u){const g=c.apply(this,[m]);return u?(g.then(l,u),Promise.resolve()):g},s.setRemoteDescription=p,p=function(m,l,u){const g=h.apply(this,[m]);return u?(g.then(l,u),Promise.resolve()):g},s.addIceCandidate=p}function He(t){const s=t&&t.navigator;if(s.mediaDevices&&s.mediaDevices.getUserMedia){const i=s.mediaDevices,r=i.getUserMedia.bind(i);s.mediaDevices.getUserMedia=a=>r(Ke(a))}!s.getUserMedia&&s.mediaDevices&&s.mediaDevices.getUserMedia&&(s.getUserMedia=(function(r,a,c){s.mediaDevices.getUserMedia(r).then(a,c)}).bind(s))}function Ke(t){return t&&t.video!==void 0?Object.assign({},t,{video:be(t.video)}):t}function qe(t){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection;t.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const c=[];for(let h=0;h<r.iceServers.length;h++){let p=r.iceServers[h];p.urls===void 0&&p.url?(w("RTCIceServer.url","RTCIceServer.urls"),p=JSON.parse(JSON.stringify(p)),p.urls=p.url,delete p.url,c.push(p)):c.push(r.iceServers[h])}r.iceServers=c}return new s(r,a)},t.RTCPeerConnection.prototype=s.prototype,"generateCertificate"in s&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return s.generateCertificate}})}function We(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ze(t){const s=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(h=>h.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):r.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find(h=>h.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo===!0&&!c&&this.addTransceiver("video",{direction:"recvonly"})}return s.apply(this,arguments)}}function Qe(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const fe=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Qe,shimCallbacksAPI:Be,shimConstraints:Ke,shimCreateOfferLegacy:Ze,shimGetUserMedia:He,shimLocalStreamsAPI:$e,shimRTCIceServerUrls:qe,shimRemoteStreamsAPI:Je,shimTrackEventTransceiver:We},Symbol.toStringTag,{value:"Module"}));var Ye={exports:{}};(function(t){const s={};s.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},s.localCName=s.generateIdentifier(),s.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},s.splitSections=function(i){return i.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},s.getDescription=function(i){const r=s.splitSections(i);return r&&r[0]},s.getMediaSections=function(i){const r=s.splitSections(i);return r.shift(),r},s.matchPrefix=function(i,r){return s.splitLines(i).filter(a=>a.indexOf(r)===0)},s.parseCandidate=function(i){let r;i.indexOf("a=candidate:")===0?r=i.substring(12).split(" "):r=i.substring(10).split(" ");const a={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let c=8;c<r.length;c+=2)switch(r[c]){case"raddr":a.relatedAddress=r[c+1];break;case"rport":a.relatedPort=parseInt(r[c+1],10);break;case"tcptype":a.tcpType=r[c+1];break;case"ufrag":a.ufrag=r[c+1],a.usernameFragment=r[c+1];break;default:a[r[c]]===void 0&&(a[r[c]]=r[c+1]);break}return a},s.writeCandidate=function(i){const r=[];r.push(i.foundation);const a=i.component;a==="rtp"?r.push(1):a==="rtcp"?r.push(2):r.push(a),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);const c=i.type;return r.push("typ"),r.push(c),c!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},s.parseIceOptions=function(i){return i.substring(14).split(" ")},s.parseRtpMap=function(i){let r=i.substring(9).split(" ");const a={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),a.name=r[0],a.clockRate=parseInt(r[1],10),a.channels=r.length===3?parseInt(r[2],10):1,a.numChannels=a.channels,a},s.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);const a=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(a!==1?"/"+a:"")+`\r
`},s.parseExtmap=function(i){const r=i.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},s.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},s.parseFmtp=function(i){const r={};let a;const c=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<c.length;h++)a=c[h].trim().split("="),r[a[0].trim()]=a[1];return r},s.writeFmtp=function(i){let r="",a=i.payloadType;if(i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const c=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?c.push(h+"="+i.parameters[h]):c.push(h)}),r+="a=fmtp:"+a+" "+c.join(";")+`\r
`}return r},s.parseRtcpFb=function(i){const r=i.substring(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},s.writeRtcpFb=function(i){let r="",a=i.payloadType;return i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(c=>{r+="a=rtcp-fb:"+a+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),r},s.parseSsrcMedia=function(i){const r=i.indexOf(" "),a={ssrc:parseInt(i.substring(7,r),10)},c=i.indexOf(":",r);return c>-1?(a.attribute=i.substring(r+1,c),a.value=i.substring(c+1)):a.attribute=i.substring(r+1),a},s.parseSsrcGroup=function(i){const r=i.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(a=>parseInt(a,10))}},s.getMid=function(i){const r=s.matchPrefix(i,"a=mid:")[0];if(r)return r.substring(6)},s.parseFingerprint=function(i){const r=i.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},s.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:s.matchPrefix(i+r,"a=fingerprint:").map(s.parseFingerprint)}},s.writeDtlsParameters=function(i,r){let a="a=setup:"+r+`\r
`;return i.fingerprints.forEach(c=>{a+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),a},s.parseCryptoLine=function(i){const r=i.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},s.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?s.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},s.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const r=i.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},s.getCryptoParameters=function(i,r){return s.matchPrefix(i+r,"a=crypto:").map(s.parseCryptoLine)},s.getIceParameters=function(i,r){const a=s.matchPrefix(i+r,"a=ice-ufrag:")[0],c=s.matchPrefix(i+r,"a=ice-pwd:")[0];return a&&c?{usernameFragment:a.substring(12),password:c.substring(10)}:null},s.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},s.parseRtpParameters=function(i){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=s.splitLines(i)[0].split(" ");r.profile=c[2];for(let p=3;p<c.length;p++){const m=c[p],l=s.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(l){const u=s.parseRtpMap(l),g=s.matchPrefix(i,"a=fmtp:"+m+" ");switch(u.parameters=g.length?s.parseFmtp(g[0]):{},u.rtcpFeedback=s.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(s.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}s.matchPrefix(i,"a=extmap:").forEach(p=>{r.headerExtensions.push(s.parseExtmap(p))});const h=s.matchPrefix(i,"a=rtcp-fb:* ").map(s.parseRtcpFb);return r.codecs.forEach(p=>{h.forEach(m=>{p.rtcpFeedback.find(u=>u.type===m.type&&u.parameter===m.parameter)||p.rtcpFeedback.push(m)})}),r},s.writeRtpDescription=function(i,r){let a="";a+="m="+i+" ",a+=r.codecs.length>0?"9":"0",a+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=r.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(h=>{a+=s.writeRtpMap(h),a+=s.writeFmtp(h),a+=s.writeRtcpFb(h)});let c=0;return r.codecs.forEach(h=>{h.maxptime>c&&(c=h.maxptime)}),c>0&&(a+="a=maxptime:"+c+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(h=>{a+=s.writeExtmap(h)}),a},s.parseRtpEncodingParameters=function(i){const r=[],a=s.parseRtpParameters(i),c=a.fecMechanisms.indexOf("RED")!==-1,h=a.fecMechanisms.indexOf("ULPFEC")!==-1,p=s.matchPrefix(i,"a=ssrc:").map(y=>s.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),m=p.length>0&&p[0].ssrc;let l;const u=s.matchPrefix(i,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(b=>parseInt(b,10)));u.length>0&&u[0].length>1&&u[0][0]===m&&(l=u[0][1]),a.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let v={ssrc:m,codecPayloadType:parseInt(y.parameters.apt,10)};m&&l&&(v.rtx={ssrc:l}),r.push(v),c&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},r.push(v))}}),r.length===0&&m&&r.push({ssrc:m});let g=s.matchPrefix(i,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-50*40*8:g=void 0,r.forEach(y=>{y.maxBitrate=g})),r},s.parseRtcpParameters=function(i){const r={},a=s.matchPrefix(i,"a=ssrc:").map(p=>s.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];a&&(r.cname=a.value,r.ssrc=a.ssrc);const c=s.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=c.length>0,r.compound=c.length===0;const h=s.matchPrefix(i,"a=rtcp-mux");return r.mux=h.length>0,r},s.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},s.parseMsid=function(i){let r;const a=s.matchPrefix(i,"a=msid:");if(a.length===1)return r=a[0].substring(7).split(" "),{stream:r[0],track:r[1]};const c=s.matchPrefix(i,"a=ssrc:").map(h=>s.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");if(c.length>0)return r=c[0].value.split(" "),{stream:r[0],track:r[1]}},s.parseSctpDescription=function(i){const r=s.parseMLine(i),a=s.matchPrefix(i,"a=max-message-size:");let c;a.length>0&&(c=parseInt(a[0].substring(19),10)),isNaN(c)&&(c=65536);const h=s.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:r.fmt,maxMessageSize:c};const p=s.matchPrefix(i,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:c}}},s.writeSctpDescription=function(i,r){let a=[];return i.protocol!=="DTLS/SCTP"?a=["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:a=["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&a.push("a=max-message-size:"+r.maxMessageSize+`\r
`),a.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,22)},s.writeSessionBoilerplate=function(i,r,a){let c;const h=r!==void 0?r:2;return i?c=i:c=s.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+c+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},s.getDirection=function(i,r){const a=s.splitLines(i);for(let c=0;c<a.length;c++)switch(a[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[c].substring(2)}return r?s.getDirection(r):"sendrecv"},s.getKind=function(i){return s.splitLines(i)[0].split(" ")[0].substring(2)},s.isRejected=function(i){return i.split(" ",2)[1]==="0"},s.parseMLine=function(i){const a=s.splitLines(i)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},s.parseOLine=function(i){const a=s.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},s.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const r=s.splitLines(i);for(let a=0;a<r.length;a++)if(r[a].length<2||r[a].charAt(1)!=="=")return!1;return!0},t.exports=s})(Ye);var Xe=Ye.exports;const I=St(Xe),Ot=bt({__proto__:null,default:I},[Xe]);function z(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const s=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const a=new s(r),c=I.parseCandidate(r.candidate);for(const h in c)h in a||Object.defineProperty(a,h,{value:c[h]});return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new s(r)},t.RTCIceCandidate.prototype=s.prototype,O(t,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i))}function Z(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||O(t,"icecandidate",s=>{if(s.candidate){const i=I.parseCandidate(s.candidate.candidate);i.type==="relay"&&(s.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return s})}function V(t,s){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(p){if(!p||!p.sdp)return!1;const m=I.splitSections(p.sdp);return m.shift(),m.some(l=>{const u=I.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const l=parseInt(m[1],10);return l!==l?-1:l},a=function(p){let m=65536;return s.browser==="firefox"&&(s.version<57?p===-1?m=16384:m=2147483637:s.version<60?m=s.version===57?65535:65536:m=2147483637),m},c=function(p,m){let l=65536;s.browser==="firefox"&&s.version===57&&(l=65535);const u=I.matchPrefix(p.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):s.browser==="firefox"&&m!==-1&&(l=2147483637),l},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,s.browser==="chrome"&&s.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=r(arguments[0]),l=a(m),u=c(arguments[0],m);let g;l===0&&u===0?g=Number.POSITIVE_INFINITY:l===0||u===0?g=Math.max(l,u):g=Math.min(l,u);const y={};Object.defineProperty(y,"maxMessageSize",{get(){return g}}),this._sctp=y}return h.apply(this,arguments)}}function G(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function s(r,a){const c=r.send;r.send=function(){const p=arguments[0],m=p.length||p.size||p.byteLength;if(r.readyState==="open"&&a.sctp&&m>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return c.apply(r,arguments)}}const i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=i.apply(this,arguments);return s(a,this),a},O(t,"datachannel",r=>(s(r.channel,r.target),r))}function Q(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype;Object.defineProperty(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const r=s[i];s[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const c=a.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const h=new Event("connectionstatechange",a);c.dispatchEvent(h)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Y(t,s){if(!t.RTCPeerConnection||s.browser==="chrome"&&s.version>=71||s.browser==="safari"&&s.version>=605)return;const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(h=>h.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return i.apply(this,arguments)}}function $(t,s){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const i=t.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(s.browser==="chrome"&&s.version<78||s.browser==="firefox"&&s.version<68||s.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function J(t,s){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const i=t.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return i.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?i.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(h=>i.apply(this,[h]))})}const Mt=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Y,shimAddIceCandidateNullOrEmpty:$,shimConnectionState:Q,shimMaxMessageSize:V,shimParameterlessSetLocalDescription:J,shimRTCIceCandidate:z,shimRTCIceCandidateRelayProtocol:Z,shimSendThrowTypeError:G},Symbol.toStringTag,{value:"Module"}));function It({window:t}={},s={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=Te,r=xt(t),a={browserDetails:r,commonShim:Mt,extractVersion:N,disableLog:Rt,disableWarnings:Pt,sdp:Ot};switch(r.browser){case"chrome":if(!le||!q||!s.shimChrome)return i("Chrome shim is not included in this adapter release."),a;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),a;i("adapter.js shimming chrome."),a.browserShim=le,$(t,r),J(t),Re(t,r),Pe(t),q(t,r),xe(t),Ie(t,r),ke(t),Ee(t),Oe(t),_e(t,r),z(t),Z(t),Q(t),V(t,r),G(t),Y(t,r);break;case"firefox":if(!me||!W||!s.shimFirefox)return i("Firefox shim is not included in this adapter release."),a;i("adapter.js shimming firefox."),a.browserShim=me,$(t,r),J(t),Ae(t,r),W(t,r),De(t),Fe(t),Le(t),je(t),Ue(t),Ne(t),ze(t),Ve(t),Ge(t),z(t),Q(t),V(t,r),G(t);break;case"safari":if(!fe||!s.shimSafari)return i("Safari shim is not included in this adapter release."),a;i("adapter.js shimming safari."),a.browserShim=fe,$(t,r),J(t),qe(t),Ze(t),Be(t),$e(t),Je(t),We(t),He(t),Qe(t),z(t),Z(t),V(t,r),G(t),Y(t,r);break;default:i("Unsupported browser!");break}return a}It({window:typeof window>"u"?void 0:window});var we={exports:{}};(function(t,s){(function(i,r){t.exports=r()})(Tt,function(){return(()=>{var i={8:(c,h,p)=>{p.r(h),p.d(h,{Parser:()=>se,Printer:()=>ce,parse:()=>ht,print:()=>dt});const m=`
`,l="".concat("\r").concat(m),u=" ";let g;function y(f){return f>="0"&&f<="9"}function v(f){return f>="!"&&f<="~"}function b(f){return v(f)||f>=""&&f<=""}function T(f){return f==="!"||f>="#"&&f<="'"||f>="*"&&f<="+"||f>="-"&&f<="."||f>="0"&&f<="9"||f>="A"&&f<="Z"||f>="^"&&f<="~"}function F(f){return f>="1"&&f<="9"}function A(f){return f>="A"&&f<="Z"||f>="a"&&f<="z"}function te(f){return f==="d"||f==="h"||f==="m"||f==="s"}function H(f){return f>""&&f<"	"||f>"\v"&&f<"\f"||f>""&&f<""}function U(f){return A(f)||y(f)||f==="+"||f==="/"}function st(f){return y(f)||A(f)||f==="+"||f==="/"||f==="-"||f==="_"}function ot(f){return A(f)||y(f)||f==="+"||f==="/"}function re(f,e){var n=Object.keys(f);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(f);e&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(f,d).enumerable})),n.push.apply(n,o)}return n}function ne(f){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?re(Object(n),!0).forEach(function(o){E(f,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach(function(o){Object.defineProperty(f,o,Object.getOwnPropertyDescriptor(n,o))})}return f}function E(f,e,n){return e in f?Object.defineProperty(f,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):f[e]=n,f}(function(f){f.VERSION="v",f.ORIGIN="o",f.SESSION_NAME="s",f.INFORMATION="i",f.URI="u",f.EMAIL="e",f.PHONE="p",f.CONNECTION="c",f.BANDWIDTH="b",f.TIME="t",f.REPEAT="r",f.ZONE_ADJUSTMENTS="z",f.KEY="k",f.ATTRIBUTE="a",f.MEDIA="m"})(g||(g={}));class ie{consumeText(e,n){let o=n;for(;o<e.length;){const d=e[o];if(d==="\0"||d==="\r"||d===m)break;o+=1}if(o-n==0)throw new Error("Invalid text, at ".concat(e));return o}consumeUnicastAddress(e,n,o){return this.consumeTill(e,n,u)}consumeOneOrMore(e,n,o){let d=n;for(;o(e[d]);)d++;if(d-n==0)throw new Error("Invalid rule at ".concat(n,"."));return d}consumeSpace(e,n){if(e[n]===u)return n+1;throw new Error("Invalid space at ".concat(n,"."))}consumeIP4Address(e,n){let o=n;for(let d=0;d<4;d++)if(o=this.consumeDecimalUChar(e,o),d!==3){if(e[o]!==".")throw new Error("Invalid IP4 address.");o++}return o}consumeDecimalUChar(e,n){let o=n;for(let C=0;C<3&&y(e[o]);C++,o++);if(o-n==0)throw new Error("Invalid decimal uchar.");const d=parseInt(e.slice(n,o));if(d>=0&&d<=255)return o;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,n){let o=this.consumeHexpart(e,n);return e[o]===":"&&(o+=1,o=this.consumeIP4Address(e,o)),o}consumeHexpart(e,n){let o=n;if(e[o]===":"&&e[o+1]===":"){o+=2;try{o=this.consumeHexseq(e,o)}catch{}return o}if(o=this.consumeHexseq(e,o),e[o]===":"&&e[o+1]===":"){o+=2;try{o=this.consumeHexseq(e,o)}catch{}return o}return o}consumeHexseq(e,n){let o=n;for(;o=this.consumeHex4(e,o),e[o]===":"&&e[o+1]!==":";)o+=1;return o}consumeHex4(e,n){let o=0;for(;o<4;o++)if(!((d=e[n+o])>="0"&&d<="9"||d>="a"&&d<="f"||d>="A"&&d<="F")){if(o===0)throw new Error("Invalid hex 4");break}var d;return n+o}consumeFQDN(e,n){let o=n;for(;y(e[o])||A(e[o])||e[o]==="-"||e[o]===".";)o+=1;if(o-n<4)throw new Error("Invalid FQDN");return o}consumeExtnAddr(e,n){return this.consumeOneOrMore(e,n,b)}consumeMulticastAddress(e,n,o){switch(o){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,n);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,n);default:try{return this.consumeFQDN(e,n)}catch{return this.consumeExtnAddr(e,n)}}}consumeIP6MulticastAddress(e,n){const o=this.consumeHexpart(e,n);return e[o]==="/"?this.consumeInteger(e,o+1):o}consumeIP4MulticastAddress(e,n){let o=n+3;const d=e.slice(n,o),C=parseInt(d);if(C<224||C>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let S=0;S<3;S++){if(e[o]!==".")throw new Error("Invalid IP4 multicast address.");o+=1,o=this.consumeDecimalUChar(e,o)}return e[o]==="/"&&(o+=1),o=this.consumeTTL(e,o),e[o]==="/"&&(o=this.consumeInteger(e,o)),o}consumeInteger(e,n){if(!F(e[n]))throw new Error("Invalid integer.");for(n+=1;y(e[n]);)n+=1;return n}consumeTTL(e,n){if(e[n]==="0")return n+1;if(!F(e[n]))throw new Error("Invalid TTL.");n+=1;for(let o=0;o<2&&y(e[n]);o++)n+=1;return n}consumeToken(e,n){return this.consumeOneOrMore(e,n,T)}consumeTime(e,n){let o=n;if(e[o]==="0")return o+1;for(F(e[o])&&(o+=1);y(e[o]);)o++;if(o-n<10)throw new Error("Invalid time");return o}consumeAddress(e,n){return this.consumeTill(e,n,u)}consumeTypedTime(e,n){let o=n;return o=this.consumeOneOrMore(e,o,y),te(e[o])?o+1:o}consumeRepeatInterval(e,n){if(!F(e[n]))throw new Error("Invalid repeat interval");for(n+=1;y(e[n]);)n+=1;return te(e[n])&&(n+=1),n}consumePort(e,n){return this.consumeOneOrMore(e,n,y)}consume(e,n,o){for(let d=0;d<o.length;d++){if(n+d>=e.length)throw new Error("consume exceeding value length");if(e[n+d]!==o[d])throw new Error("consume ".concat(o," failed at ").concat(d))}return n+o.length}consumeTill(e,n,o){let d=n;for(;d<e.length&&(typeof o!="string"||e[d]!==o)&&(typeof o!="function"||!o(e[d]));)d++;return d}}class se extends ie{constructor(){super(),E(this,"records",[]),E(this,"currentLine",0)}parse(e){const n=this.probeEOL(e);this.records=e.split(n).filter(vt=>!!vt.trim()).map(this.parseLine),this.currentLine=0;const o=this.parseVersion(),d=this.parseOrigin(),C=this.parseSessionName(),S=this.parseInformation(),P=this.parseUri(),k=this.parseEmail(),D=this.parsePhone(),lt=this.parseConnection(),mt=this.parseBandWidth(),ft=this.parseTimeFields(),gt=this.parseKey(),yt=this.parseSessionAttribute(),Ct=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:o,origin:d,sessionName:C,information:S,uri:P,emails:k,phones:D,connection:lt,bandwidths:mt,timeFields:ft,key:gt,attributes:yt,mediaDescriptions:Ct}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let n=0;n<e.length;n++)if(e[n]===m)return e[n-1]==="\r"?l:m;throw new Error("Invalid newline character.")}parseLine(e,n){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const o=e[0];if(e[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:o,value:e.slice(2),line:n,cur:0}}parseSessionAttribute(){const e=new at;for(;this.currentLine<this.records.length;){const n=this.getCurrentRecord();if(n.type!==g.ATTRIBUTE)break;const o={attField:this.extractOneOrMore(n,d=>T(d)&&d!==":"),_cur:0};n.value[n.cur]===":"&&(n.cur+=1,o.attValue=this.extractOneOrMore(n,H)),e.parse(o),this.currentLine++}return e.digest()}parseMediaAttributes(e){const n=new ct(e);for(;this.currentLine<this.records.length;){const o=this.getCurrentRecord();if(o.type!==g.ATTRIBUTE)break;const d={attField:this.extractOneOrMore(o,C=>T(C)&&C!==":"),_cur:0};o.value[o.cur]===":"&&(o.cur+=1,d.attValue=this.extractOneOrMore(o,H)),n.parse(d),this.currentLine++}return n.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===g.KEY){if(e.value==="prompt"||e.value==="clear:"||e.value==="base64:"||e.value==="uri:")return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===g.ZONE_ADJUSTMENTS){const n=[];for(;;)try{const o=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let d=!1;e.value[e.cur]==="-"&&(d=!0,e.cur+=1);const C=this.extract(e,this.consumeTypedTime);n.push({time:o,typedTime:C,back:d})}catch{break}if(n.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,n}return[]}parseRepeat(){const e=[];for(;;){const n=this.getCurrentRecord();if(n.type!==g.REPEAT)break;{const o=this.extract(n,this.consumeRepeatInterval),d=this.parseTypedTime(n);e.push({repeatInterval:o,typedTimes:d}),this.currentLine++}}return e}parseTypedTime(e){const n=[];for(;;)try{this.consumeSpaceForRecord(e),n.push(this.extract(e,this.consumeTypedTime))}catch{break}if(n.length===0)throw new Error("Invalid typed time.");return n}parseTime(){const e=this.getCurrentRecord(),n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const o=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:n,stopTime:o}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const n=this.getCurrentRecord();if(n.type!==g.BANDWIDTH)break;{const o=this.extractOneOrMore(n,T);if(n.value[n.cur]!==":")throw new Error("Invalid bandwidth field.");n.cur++;const d=this.extractOneOrMore(n,y);e.push({bwtype:o,bandwidth:d}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==g.VERSION)throw new Error("first sdp record must be version");const n=e.value.slice(0,this.consumeOneOrMore(e.value,0,y));if(n.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,n}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==g.ORIGIN)throw new Error("second line of sdp must be origin");const n=this.extractOneOrMore(e,b);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,y);this.consumeSpaceForRecord(e);const d=this.extractOneOrMore(e,y);this.consumeSpaceForRecord(e);const C=this.extractOneOrMore(e,T);this.consumeSpaceForRecord(e);const S=this.extractOneOrMore(e,T);this.consumeSpaceForRecord(e);const P=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:n,sessId:o,sessVersion:d,nettype:C,addrtype:S,unicastAddress:P}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===g.SESSION_NAME){const n=this.extract(e,this.consumeText);return this.currentLine++,n}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==g.INFORMATION)return;const n=this.extract(e,this.consumeText);return this.currentLine++,n}parseUri(){const e=this.getCurrentRecord();if(e.type===g.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const n=this.getCurrentRecord();if(n.type!==g.EMAIL)break;e.push(n.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const n=this.getCurrentRecord();if(n.type!==g.PHONE)break;e.push(n.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===g.CONNECTION){const n=this.extractOneOrMore(e,T);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,T);this.consumeSpaceForRecord(e);const d=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:n,addrtype:o,address:d}}}parseMedia(){const e=this.getCurrentRecord(),n=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let o=this.extract(e,this.consumePort);e.value[e.cur]==="/"&&(e.cur+=1,o+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const d=[];for(d.push(this.extract(e,this.consumeToken));e.value[e.cur]==="/";)e.cur+=1,d.push(this.extract(e,this.consumeToken));if(d.length===0)throw new Error("Invalid proto");const C=this.parseFmt(e);return this.currentLine++,{mediaType:n,port:o,protos:d,fmts:C}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===g.TIME;){const n=this.parseTime(),o=this.parseRepeat(),d=this.parseZone();e.push({time:n,repeats:o,zones:d})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.MEDIA;){const n=this.parseMedia(),o=this.parseInformation(),d=this.parseConnections(),C=this.parseBandWidth(),S=this.parseKey(),P=this.parseMediaAttributes(n);e.push({media:n,information:o,connections:d,bandwidths:C,key:S,attributes:P})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const n=[];for(;;)try{this.consumeSpaceForRecord(e),n.push(this.extract(e,this.consumeToken))}catch{break}if(n.length===0)throw new Error("Invalid fmts");return n}extract(e,n,...o){const d=n.call(this,e.value,e.cur,...o),C=e.value.slice(e.cur,d);return e.cur=d,C}extractOneOrMore(e,n){const o=this.consumeOneOrMore(e.value,e.cur,n),d=e.value.slice(e.cur,o);return e.cur=o,d}consumeSpaceForRecord(e){if(e.value[e.cur]!==u)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class oe extends ie{constructor(...e){super(...e),E(this,"attributes",void 0),E(this,"digested",!1)}extractOneOrMore(e,n,o){const d=this.consumeOneOrMore(e.attValue,e._cur,n),C=e.attValue.slice(e._cur,d),[S,P]=o||[];if(typeof S=="number"&&C.length<S)throw new Error("error in length, should be more or equal than ".concat(S," characters."));if(typeof P=="number"&&C.length>P)throw new Error("error in length, should be less or equal than ".concat(P," characters."));return e._cur=d,C}consumeAttributeSpace(e){if(e.attValue[e._cur]!==u)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,n,...o){if(!e.attValue)throw new Error("Nothing to extract from attValue.");const d=n.call(this,e.attValue,e._cur,...o),C=e.attValue.slice(e._cur,d);return e._cur=d,C}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,n){if(!e.attValue)throw new Error;for(let o=0;o<n.length;o++)if(n[o]!==e.attValue[e._cur+o])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,U,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,U,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const n=[];for(;!this.atEnd(e);){n.push(this.extractOneOrMore(e,U));try{this.consumeAttributeSpace(e)}catch(o){if(this.atEnd(e))break;throw o}}this.attributes.iceOptions=n}parseFingerprint(e){const n=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const o=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:n,fingerprint:o})}parseExtmap(e){const n=this.extractOneOrMore(e,y);let o;this.peekChar(e)==="/"&&(this.extract(e,this.consume,"/"),o=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const d=this.extract(e,this.consumeTill,u),C=ne(ne({entry:parseInt(n,10)},o&&{direction:o}),{},{extensionName:d});this.peekChar(e)===u&&(this.consumeAttributeSpace(e),C.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(C)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const n=this.extract(e,this.consumeTill);if(n!=="active"&&n!=="passive"&&n!=="actpass"&&n!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=n}}class at extends oe{constructor(...e){super(...e),E(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(n){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),n}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const n=this.extract(e,this.consumeToken),o=[];for(;!this.atEnd(e)&&this.peekChar(e)===u;)this.consumeAttributeSpace(e),o.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:n,identificationTag:o})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,st)}parseIdentity(e){const n=this.extractOneOrMore(e,ot),o=[];for(;!this.atEnd(e)&&this.peekChar(e)===u;){this.consumeAttributeSpace(e);const d=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const C=this.extractOneOrMore(e,S=>S!==u&&H(S));o.push({name:d,value:C})}this.attributes.identities.push({assertionValue:n,extensions:o})}parseMsidSemantic(e){this.peekChar(e)===u&&this.consumeAttributeSpace(e);const n={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch{break}if(this.peekChar(e)==="*"){this.extract(e,this.consume,"*"),n.applyForAll=!0;break}{const o=this.extract(e,this.consumeTill,u);n.identifierList.push(o)}}this.attributes.msidSemantic=n}}class ct extends oe{constructor(e){super(),E(this,"attributes",void 0),e.protos.indexOf("RTP")!==-1||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(n){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),n}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const n=this.extractOneOrMore(e,U,[1,32]);this.consumeAttributeSpace(e);const o=this.extractOneOrMore(e,y,[1,5]);this.consumeAttributeSpace(e);const d=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const C=this.extractOneOrMore(e,y,[1,10]);this.consumeAttributeSpace(e);const S=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const P=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const k={foundation:n,componentId:o,transport:d,priority:C,connectionAddress:S,port:P,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),k.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),k.relPort=this.extract(e,this.consumePort));this.peekChar(e)===u;){this.consumeAttributeSpace(e);const D=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),k.extension[D]=this.extractOneOrMore(e,v)}this.attributes.candidates.push(k)}parseRemoteCandidate(e){const n=[];for(;;){const o=this.extractOneOrMore(e,y,[1,5]);this.consumeAttributeSpace(e);const d=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const C=this.extract(e,this.consumePort);n.push({componentId:o,connectionAddress:d,port:C});try{this.consumeAttributeSpace(e)}catch{break}}this.attributes.remoteCandidatesList.push(n)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const n=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const o=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const d={encodingName:o,clockRate:this.extractOneOrMore(e,y)};this.atEnd(e)||this.peekChar(e)!=="/"||(this.extract(e,this.consume,"/"),d.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const C=this.attributes.payloads.find(S=>S.payloadType===parseInt(n,10));C?C.rtpMap=d:this.attributes.payloads.push({payloadType:parseInt(n,10),rtpMap:d,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const n=this.extractOneOrMore(e,y);this.consumeAttributeSpace(e);const o=this.extract(e,this.consumeTill,":");let d;this.peekChar(e)===":"&&(this.extract(e,this.consume,":"),d=this.extract(e,this.consumeTill));const C=this.attributes.ssrcs.find(S=>S.ssrcId===parseInt(n,10));C?C.attributes[o]=d:this.attributes.ssrcs.push({ssrcId:parseInt(n,10),attributes:{[o]:d}})}parseFmtp(e){const n=this.extract(e,this.consumeTill,u);this.consumeAttributeSpace(e);const o=this.extract(e,this.consumeTill),d={};o.split(";").forEach(S=>{let[P,k]=S.split("=");P=P.trim();const D=typeof k=="string"?k.trim():null;typeof P=="string"&&P.length>0&&(d[P]=D)});const C=this.attributes.payloads.find(S=>S.payloadType===parseInt(n,10));C?C.fmtp={parameters:d}:this.attributes.payloads.push({payloadType:parseInt(n,10),rtcpFeedbacks:[],fmtp:{parameters:d}})}parseFmtParameters(e){const n={},o=this.extract(e,this.consumeTill,"=");e._cur++;const d=this.extract(e,this.consumeTill,";");for(n[o]=d;e.attValue[e._cur]===";";){const C=this.extract(e,this.consumeTill,"=");e._cur++;const S=this.extract(e,this.consumeTill,";");n[C]=S}return n}parseRtcpFb(e){let n="";n=this.peekChar(e)==="*"?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,u),this.consumeAttributeSpace(e);const o=this.extract(e,this.consumeTill,u);let d;switch(o){case"trr-int":d={type:o,interval:this.extract(e,this.consumeTill)};break;case"ack":case"nack":default:{const C={type:o};this.peekChar(e)===u&&(this.consumeAttributeSpace(e),C.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===u&&(C.additional=this.extract(e,this.consumeTill))),d=C}}if(n==="*")this.attributes.rtcpFeedbackWildcards.push(d);else{const C=this.attributes.payloads.find(S=>S.payloadType===parseInt(n,10));C?C.rtcpFeedbacks.push(d):this.attributes.payloads.push({payloadType:parseInt(n,10),rtcpFeedbacks:[d]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const n={port:this.extract(e,this.consumePort)};this.peekChar(e)===u&&(this.consumeAttributeSpace(e),n.netType=this.extractOneOrMore(e,T),this.consumeAttributeSpace(e),n.addressType=this.extractOneOrMore(e,T),this.consumeAttributeSpace(e),n.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=n}parseMsid(e){const n={id:this.extractOneOrMore(e,T,[1,64])};this.peekChar(e)===u&&(this.consumeAttributeSpace(e),n.appdata=this.extractOneOrMore(e,T,[1,64])),this.attributes.msids.push(n)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const n=this.extractOneOrMore(e,d=>A(d)||y(d)||d==="_"||d==="-");this.consumeAttributeSpace(e);const o={id:n,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===u){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const d=[];for(;;){const C=this.extract(e,this.consumeToken);d.push(C);try{this.extract(e,this.consume,",")}catch{break}}o.payloads=d,this.peekChar(e)===u&&this.extract(e,this.consume,u)}for(;;){const d=this.extract(e,this.consumeToken);switch(d){case"depend":{const C={type:d,rids:this.extract(e,this.consume,"=").split(",")};o.params.push(C);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const C={type:d};this.peekChar(e)==="="&&(this.extract(e,this.consume,"="),C.val=this.extract(e,this.consumeTill,";")),o.params.push(C)}}try{this.extract(e,this.consume,";")}catch{break}}}this.attributes.rids.push(o)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,y,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const n=this.extract(e,this.consumeToken),o=[];for(;;)try{this.consumeAttributeSpace(e);const d=this.extract(e,this.consumeInteger);o.push(parseInt(d,10))}catch{break}this.attributes.ssrcGroups.push({semantic:n,ssrcIds:o})}}function ae(f,e,n){return e in f?Object.defineProperty(f,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):f[e]=n,f}class ce{constructor(){ae(this,"eol",l)}print(e,n){let o="";return n&&(this.eol=n),o+=this.printVersion(e.version),o+=this.printOrigin(e.origin),o+=this.printSessionName(e.sessionName),o+=this.printInformation(e.information),o+=this.printUri(e.uri),o+=this.printEmail(e.emails),o+=this.printPhone(e.phones),o+=this.printConnection(e.connection),o+=this.printBandwidth(e.bandwidths),o+=this.printTimeFields(e.timeFields),o+=this.printKey(e.key),o+=this.printSessionAttributes(e.attributes),o+=this.printMediaDescription(e.mediaDescriptions),o}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let n="";for(const o of e)n+="e=".concat(o).concat(this.eol);return n}printPhone(e){let n="";for(const o of e)n+="e=".concat(o).concat(this.eol);return n}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let n="";for(const o of e)n+="b=".concat(o.bwtype,":").concat(o.bandwidth).concat(this.eol);return n}printTimeFields(e){let n="";for(const o of e){n+="t=".concat(o.time.startTime," ").concat(o.time.startTime).concat(this.eol);for(const d of o.repeats)n+="r=".concat(d.repeatInterval," ").concat(d.typedTimes.join(" ")).concat(this.eol);o.zoneAdjustments&&(n+="z=",n+="z=".concat(o.zoneAdjustments.map(d=>"".concat(d.time," ").concat(d.back?"-":""," ").concat(d.typedTime)).join(" ")).concat(this.eol),n+=this.eol)}return n}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let n="";for(const o of e)n+="a=".concat(o.attField).concat(o.attValue?":".concat(o.attValue):"").concat(this.eol);return n}printMediaDescription(e){let n="";for(const o of e)n+=this.printMedia(o.media),n+=this.printInformation(o.information),n+=this.printConnections(o.connections),n+=this.printBandwidth(o.bandwidths),n+=this.printKey(o.key),n+=this.printMediaAttributes(o);return n}printConnections(e){let n="";for(const o of e)n+=this.printConnection(o);return n}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new pt(this.eol).print(e)}printMediaAttributes(e){return new ut(this.eol).print(e)}}class pe{constructor(e){ae(this,"eol",void 0),this.eol=e}printIceUfrag(e){return e===void 0?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return e===void 0?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return e===void 0?"":"a=ice-options:".concat(e.join(u)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(n=>"a=fingerprint:".concat(n.hashFunction).concat(u).concat(n.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(n=>"a=extmap:".concat(n.entry).concat(n.direction?"/".concat(n.direction):"").concat(u).concat(n.extensionName).concat(n.extensionAttributes?"".concat(u).concat(n.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return e===void 0?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(n=>"a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol)).join("")}}class pt extends pe{print(e){let n="";return n+=this.printGroups(e.groups),n+=this.printMsidSemantic(e.msidSemantic),n+=this.printIceLite(e.iceLite),n+=this.printIceUfrag(e.iceUfrag),n+=this.printIcePwd(e.icePwd),n+=this.printIceOptions(e.iceOptions),n+=this.printFingerprints(e.fingerprints),n+=this.printSetup(e.setup),n+=this.printTlsId(e.tlsId),n+=this.printIdentity(e.identities),n+=this.printExtmap(e.extmaps),n+=this.printUnrecognized(e.unrecognized),n}printGroups(e){let n="";return e.length>0&&(n+=e.map(o=>"a=group:".concat(o.semantic).concat(o.identificationTag.map(d=>"".concat(u).concat(d)).join("")).concat(this.eol)).join("")),n}printIceLite(e){return e===void 0?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return e.length===0?"":e.map(n=>"a=identity:".concat(n.assertionValue).concat(n.extensions.map(o=>"".concat(u).concat(o.name).concat(o.value?"=".concat(o.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let n="a=msid-semantic:".concat(e.semantic);return e.applyForAll?n+="".concat(u,"*"):e.identifierList.length>0&&(n+=e.identifierList.map(o=>"".concat(u).concat(o))),n+this.eol}}class ut extends pe{print(e){const n=e.attributes;let o="";return o+=this.printRTCP(n.rtcp),o+=this.printIceUfrag(n.iceUfrag),o+=this.printIcePwd(n.icePwd),o+=this.printIceOptions(n.iceOptions),o+=this.printCandidates(n.candidates),o+=this.printRemoteCandidatesList(n.remoteCandidatesList),o+=this.printEndOfCandidates(n.endOfCandidates),o+=this.printFingerprints(n.fingerprints),o+=this.printSetup(n.setup),o+=this.printMid(n.mid),o+=this.printExtmap(n.extmaps),o+=this.printRTPRelated(n),o+=this.printPtime(n.ptime),o+=this.printMaxPtime(n.maxPtime),o+=this.printDirection(n.direction),o+=this.printSSRCGroups(n.ssrcGroups),o+=this.printSSRC(n.ssrcs),o+=this.printRTCPMux(n.rtcpMux),o+=this.printRTCPMuxOnly(n.rtcpMuxOnly),o+=this.printRTCPRsize(n.rtcpRsize),o+=this.printMSId(n.msids),o+=this.printImageattr(n.imageattr),o+=this.printRid(n.rids),o+=this.printSimulcast(n.simulcast),o+=this.printSCTPPort(n.sctpPort),o+=this.printMaxMessageSize(n.maxMessageSize),o+=this.printUnrecognized(n.unrecognized),o}printCandidates(e){return e.map(n=>"a=candidate:".concat(n.foundation).concat(u).concat(n.componentId).concat(u).concat(n.transport).concat(u).concat(n.priority).concat(u).concat(n.connectionAddress).concat(u).concat(n.port).concat(u,"typ").concat(u).concat(n.type).concat(n.relAddr?"".concat(u,"raddr").concat(u).concat(n.relAddr):"").concat(n.relPort?"".concat(u,"rport").concat(u).concat(n.relPort):"").concat(Object.keys(n.extension).map(o=>"".concat(u).concat(o).concat(u).concat(n.extension[o])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(n=>"a=remote-candidates:".concat(n.join(u)).concat(this.eol)).join("")}printEndOfCandidates(e){return e===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const n=e.payloads;let o="";o+=e.rtcpFeedbackWildcards.map(d=>this.printRTCPFeedback("*",d)).join("");for(const d of n)o+=this.printRtpMap(d.payloadType,d.rtpMap),o+=this.printFmtp(d.payloadType,d.fmtp),o+=d.rtcpFeedbacks.map(C=>this.printRTCPFeedback(d.payloadType,C)).join("");return o}printFmtp(e,n){if(!n)return"";const o=Object.keys(n.parameters);return o.length===1&&n.parameters[o[0]]===null?"a=fmtp:".concat(e).concat(u).concat(o[0]).concat(this.eol):"a=fmtp:".concat(e).concat(u).concat(Object.keys(n.parameters).map(d=>"".concat(d,"=").concat(n.parameters[d])).join(";")).concat(this.eol)}printRtpMap(e,n){return n?"a=rtpmap:".concat(e).concat(u).concat(n.encodingName,"/").concat(n.clockRate).concat(n.encodingParameters?"/".concat(n.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,n){let o="a=rtcp-fb:".concat(e).concat(u),d=n;switch(d.type){case"trr-int":o+="ttr-int".concat(u).concat(d.interval);break;case"ack":case"nack":default:d=d,o+="".concat(d.type),d.parameter&&(o+="".concat(u).concat(d.parameter),d.additional&&(o+="".concat(u).concat(d.additional)))}return o+this.eol}printPtime(e){return e===void 0?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return e===void 0?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return e===void 0?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(n=>Object.keys(n.attributes).map(o=>"a=ssrc:".concat(n.ssrcId.toString(10)).concat(u).concat(o).concat(n.attributes[o]?":".concat(n.attributes[o]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return e===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return e===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return e===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(e===void 0)return"";let n="a=rtcp:".concat(e.port);return e.netType&&(n+="".concat(u).concat(e.netType)),e.addressType&&(n+="".concat(u).concat(e.addressType)),e.address&&(n+="".concat(u).concat(e.address)),n+this.eol}printMSId(e){return e.map(n=>"a=msid:".concat(n.id).concat(n.appdata?"".concat(u).concat(n.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(n=>"a=imageattr:".concat(n).concat(this.eol)).join("")}printRid(e){return e.map(n=>{let o="a=rid:".concat(n.id).concat(u).concat(n.direction);return n.payloads&&(o+="".concat(u,"pt=").concat(n.payloads.join(","))),n.params.length>0&&(o+="".concat(u).concat(n.params.map(d=>d.type==="depend"?"depend=".concat(d.rids.join(",")):"".concat(d.type,"=").concat(d.val)).join(";"))),o+this.eol}).join("")}printSimulcast(e){return e===void 0?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return e===void 0?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return e===void 0?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return e===void 0?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(n=>"a=ssrc-group:".concat(n.semantic).concat(n.ssrcIds.map(o=>"".concat(u).concat(o.toString(10))).join("")).concat(this.eol)).join("")}}function ht(f){return new se().parse(f)}function dt(f,e){return new ce().print(f,e)}}},r={};function a(c){if(r[c])return r[c].exports;var h=r[c]={exports:{}};return i[c](h,h.exports,a),h.exports}return a.d=(c,h)=>{for(var p in h)a.o(h,p)&&!a.o(c,p)&&Object.defineProperty(c,p,{enumerable:!0,get:h[p]})},a.o=(c,h)=>Object.prototype.hasOwnProperty.call(c,h),a.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},a(8)})()})})(we);var ge=we.exports;async function et(t,s){s.sdp=Nt(s.sdp),await t.setLocalDescription(s)}const tt={offerToReceiveAudio:!0,offerToReceiveVideo:!0};let X="vp8",L,j,M,R,x;function _(t){return t===R?"pc1":"pc2"}function _t(t){return t===R?x:R}function ee(t){console.log(`Failed to create session description: ${t.toString()}`)}async function rt(t){console.log(`Offer from pc1
${t.sdp}`),console.log("pc1 setLocalDescription start");try{await et(R,t),nt(R)}catch(s){B(s)}console.log("pc2 setRemoteDescription start");try{await x.setRemoteDescription(t),it(x)}catch(s){B(s)}console.log("pc2 createAnswer start");try{const s=await x.createAnswer();await Dt(s)}catch(s){ee(s)}}function nt(t){console.log(`${_(t)} setLocalDescription complete`)}function it(t){console.log(`${_(t)} setRemoteDescription complete`)}function B(t){console.log(`Failed to set session description: ${t.toString()}`)}function At(t){M.srcObject!==t.streams[0]&&(M.srcObject=t.streams[0],console.log("pc2 received remote stream"))}async function Dt(t){console.log(`Answer from pc2:
${t.sdp}`),console.log("pc2 setLocalDescription start");try{await et(x,t),nt(x)}catch(s){B(s)}console.log("pc1 setRemoteDescription start");try{await R.setRemoteDescription(t),it(R)}catch(s){B(s)}}async function ye(t,s){try{await _t(t).addIceCandidate(s.candidate),Lt(t)}catch(i){jt(t,i)}console.log(`${_(t)} ICE candidate:
${s.candidate?s.candidate.candidate:"(null)"}`)}function Lt(t){console.log(`${_(t)} addIceCandidate success`)}function jt(t,s){console.log(`${_(t)} failed to add ICE Candidate: ${s.toString()}`)}function Ce(t,s){t&&(console.log(`${_(t)} ICE state: ${t.iceConnectionState}`),console.log("ICE state change event: ",s))}async function Ft(){console.log("Requesting local stream");try{const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});console.log("Received local stream"),j.srcObject=t,L=t}catch(t){alert(`getUserMedia() error: ${t.name}`)}}async function Ut(){const t=L.getVideoTracks(),s=L.getAudioTracks();t.length>0&&console.log(`Using video device: ${t[0].label}`),s.length>0&&console.log(`Using audio device: ${s[0].label}`);const i={};console.log("RTCPeerConnection configuration:",i),R=new RTCPeerConnection(i),console.log("Created local peer connection object pc1"),R.addEventListener("icecandidate",r=>ye(R,r)),x=new RTCPeerConnection(i),console.log("Created remote peer connection object pc2"),x.addEventListener("icecandidate",r=>ye(x,r)),R.addEventListener("iceconnectionstatechange",r=>Ce(R,r)),x.addEventListener("iceconnectionstatechange",r=>Ce(x,r)),x.addEventListener("track",At),L.getTracks().forEach(r=>R.addTrack(r,L)),console.log("Added local stream to pc1");try{console.log("pc1 createOffer start");const r=await R.createOffer(tt);await rt(r)}catch(r){ee(r)}}async function Vt(t,s,i){j=document.getElementById(s),M=document.getElementById(i),j.addEventListener("loadedmetadata",function(){console.log(`Local video videoWidth: ${j.videoWidth}px,  videoHeight: ${j.videoHeight}px`)}),M.addEventListener("loadedmetadata",function(){console.log(`Remote video videoWidth: ${M.videoWidth}px,  videoHeight: ${M.videoHeight}px`)}),await Ft(),await Ut()}async function Gt(t){if(R&&x&&t!==X){X=t;try{console.log("pc1 createOffer start");const s=await R.createOffer(tt);await rt(s)}catch(s){ee(s)}}}function Nt(t){const s=ge.parse(t),i=s.mediaDescriptions.find(p=>p.media.mediaType==="video");if(!i)return t;const r=i.attributes.payloads.findIndex(p=>{var m;return((m=p.rtpMap)==null?void 0:m.encodingName)===X});if(r===-1)return t;const a=i.media.fmts.findIndex(p=>+p===i.attributes.payloads[r].payloadType);if(a===-1)return t;const c=i.attributes.payloads[0];i.attributes.payloads[0]=i.attributes.payloads[r],i.attributes.payloads[r]=c;const h=i.media.fmts[0];return i.media.fmts[0]=i.media.fmts[a],i.media.fmts[a]=h,ge.print(s)}async function $t(){if(!R||!x)return;const t=await R.getStats();let s={local:{},remote:{}};t.forEach(r=>{if(r.type==="outbound-rtp"&&r.kind==="video"){s.local=r;const a=Array.from(t.values()).find(c=>c.type==="codec"&&c.id===r.codecId);console.warn(a),console.warn(r),s.local.codec=a.mimeType||a.codec}});const i=await x.getStats();return i.forEach(r=>{if(r.type==="inbound-rtp"&&r.kind==="video"){s.remote=r;const a=Array.from(i.values()).find(c=>c.type==="codec"&&c.id===r.codecId);s.remote.codec=a.mimeType||a.codec}}),s}export{Gt as changeCodec,$t as getStats,Vt as startP2P};
